import*as e from"react";import{FilterService as t}from"primereact/api";import{useMountEffect as n}from"primereact/hooks";import{Tooltip as r}from"primereact/tooltip";import{classNames as l,ObjectUtils as a,DomHandler as o}from"primereact/utils";import{VirtualScroller as i}from"primereact/virtualscroller";import{InputText as u}from"primereact/inputtext";import{Ripple as c}from"primereact/ripple";function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){if(Array.isArray(e))return f(e)}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function b(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return m(e)||d(e)||b(e)||v()}function h(e){if(Array.isArray(e))return e}function g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,l=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw l}}return a}}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var x=e.memo((function(t){return e.createElement("div",{className:"p-listbox-header"},e.createElement("div",{className:"p-listbox-filter-container"},e.createElement(u,s({type:"text",value:t.filter,onChange:function(e){t.onFilter&&t.onFilter({originalEvent:e,value:e.target.value})},className:"p-listbox-filter",disabled:t.disabled,placeholder:t.filterPlaceholder},t.filterInputProps)),e.createElement("span",{className:"p-listbox-filter-icon pi pi-search"})))}));x.displayName="ListBoxHeader";var O=e.memo((function(t){var n=function(e){t.onClick&&t.onClick({originalEvent:e,option:t.option}),e.preventDefault()},r=function e(t){var n=t.nextElementSibling;return n?o.hasClass(n,"p-disabled")||o.hasClass(n,"p-listbox-item-group")?e(n):n:null},i=function e(t){var n=t.previousElementSibling;return n?o.hasClass(n,"p-disabled")||o.hasClass(n,"p-listbox-item-group")?e(n):n:null},u=l("p-listbox-item",{"p-highlight":t.selected,"p-disabled":t.disabled},t.option.className),s=t.template?a.getJSXElement(t.template,t.option):t.label;return e.createElement("li",{className:u,style:t.style,onClick:n,onTouchEnd:function(e){t.onTouchEnd&&t.onTouchEnd({originalEvent:e,option:t.option})},onKeyDown:function(e){var t=e.currentTarget;switch(e.which){case 40:var l=r(t);l&&l.focus(),e.preventDefault();break;case 38:var a=i(t);a&&a.focus(),e.preventDefault();break;case 13:n(e),e.preventDefault()}},tabIndex:"-1","aria-label":t.label,key:t.label,role:"option","aria-selected":t.selected,"aria-disabled":t.disabled},s,e.createElement(c,null))}));function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=D(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function D(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}O.displayName="ListBoxItem";var P=e.memo(e.forwardRef((function(o,u){var c,p,f=e.useState(""),m=(p=2,h(c=f)||g(c,p)||b(c,p)||E()),d=m[0],v=m[1],S=e.useRef(null),D=e.useRef(null),L=e.useRef(!1),I=(o.onFilterValueChange?o.filterValue:d)||"",j=I&&I.trim().length>0,T=function(e){var t=e.option;o.disabled||J(t)||(o.multiple?A(e.originalEvent,t):F(e.originalEvent,t),L.current=!1)},N=function(){o.disabled||(L.current=!0)},F=function(e,t){var n=R(t),r=!1,l=null;!L.current&&o.metaKeySelection?n?(e.metaKey||e.ctrlKey)&&(l=null,r=!0):(l=q(t),r=!0):(l=n?null:q(t),r=!0);r&&k(e,l)},A=function(e,t){var n=R(t),r=!1,l=null;if(!L&&o.metaKeySelection){var a=e.metaKey||e.ctrlKey;n?(l=a?G(t):[q(t)],r=!0):(l=[].concat(y(l=a&&o.value||[]),[q(t)]),r=!0)}else l=n?G(t):[].concat(y(o.value||[]),[q(t)]),r=!0;r&&o.onChange({originalEvent:e,value:l,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:l}})},K=function(e){D.current&&D.current.scrollToIndex(0);var t=e.value;o.onFilterValueChange?o.onFilterValueChange({originalEvent:e.originalEvent,value:t}):v(t)},k=function(e,t){o.onChange&&o.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:t}})},G=function(e){return o.value.filter((function(t){return!a.equals(t,q(e),o.dataKey)}))},V=function(){if(null!=o.value&&W){if(!o.optionGroupLabel)return B(o.value,W);for(var e=0;e<W.length;e++){var t=B(o.value,$(W[e]));if(-1!==t)return{group:e,option:t}}}return-1},M=function(){return o.optionValue?null:o.dataKey},B=function(e,t){var n=M();return t.findIndex((function(t){return a.equals(e,q(t),n)}))},R=function(e){var t=q(e),n=M();return o.multiple&&o.value?o.value.some((function(e){return a.equals(e,t,n)})):a.equals(o.value,t,n)},_=function(e){return o.optionLabel?a.resolveFieldData(e,o.optionLabel):e&&void 0!==e.label?e.label:e},q=function(e){return o.optionValue?a.resolveFieldData(e,o.optionValue):e&&void 0!==e.value?e.value:e},z=function(e){return o.dataKey?a.resolveFieldData(e,o.dataKey):_(e)},J=function(e){return o.optionDisabled?a.isFunction(o.optionDisabled)?o.optionDisabled(e):a.resolveFieldData(e,o.optionDisabled):!(!e||void 0===e.disabled)&&e.disabled},U=function(e){return a.resolveFieldData(e,o.optionGroupLabel)},X=function(e){return a.resolveFieldData(e,o.optionGroupLabel)},$=function(e){return a.resolveFieldData(e,o.optionGroupChildren)},H=function(){if(D.current){var e=V();-1!==e&&setTimeout((function(){return D.current.scrollToIndex(e)}),0)}};n((function(){H()}));var Y=function(t,n){return $(t).map((function(t,r){var l=_(t),a=r+"_"+z(t),i=J(t),u=i?null:o.tabIndex||0;return e.createElement(O,{key:a,label:l,option:t,style:n,template:o.itemTemplate,selected:R(t),onClick:T,onTouchEnd:N,tabIndex:u,disabled:i})}))},Q=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={height:r.props?r.props.itemSize:void 0};if(o.optionGroupLabel){var i=o.optionGroupTemplate?a.getJSXElement(o.optionGroupTemplate,t,n):X(t),u=Y(t,l),c=n+"_"+U(t);return e.createElement(e.Fragment,{key:c},e.createElement("li",{className:"p-listbox-item-group",style:l,role:"group"},i),u)}var s=_(t),p=n+"_"+z(t),f=J(t),m=f?null:o.tabIndex||0;return e.createElement(O,{key:p,label:s,option:t,style:l,template:o.itemTemplate,selected:R(t),onClick:T,onTouchEnd:N,tabIndex:m,disabled:f})},W=function(){if(j){var e=I.trim().toLocaleLowerCase(o.filterLocale),n=o.filterBy?o.filterBy.split(","):[o.optionLabel||"label"];if(o.optionGroupLabel){var r,l=[],a=C(o.options);try{for(a.s();!(r=a.n()).done;){var i=r.value,u=t.filter($(i),n,e,o.filterMatchMode,o.filterLocale);u&&u.length&&l.push(w(w({},i),{items:u}))}}catch(e){a.e(e)}finally{a.f()}return l}return t.filter(o.options,n,e,o.filterMatchMode,o.filterLocale)}return o.options}(),Z=a.isNotEmpty(o.tooltip),ee=a.findDiffKeys(o,P.defaultProps),te=l("p-listbox p-component",{"p-disabled":o.disabled},o.className),ne=l("p-listbox-list-wrapper",o.listClassName),re=function(){if(o.virtualScrollerOptions){var t=w(w({},o.virtualScrollerOptions),{items:W,onLazyLoad:function(e){return o.virtualScrollerOptions.onLazyLoad(w(w({},e),{filter:W}))},itemTemplate:function(e,t){return e&&Q(e,t.index,t)},contentTemplate:function(t){var n=l("p-listbox-list",t.className);return e.createElement("ul",{ref:t.contentRef,className:n,role:"listbox","aria-multiselectable":o.multiple,"aria-labelledby":o["aria-labelledby"],"aria-label":o["aria-label"]},t.children)}});return e.createElement(i,s({ref:D},t))}var n=W?W.map(Q):null;return e.createElement("ul",{className:"p-listbox-list",role:"listbox","aria-multiselectable":o.multiple,"aria-labelledby":o["aria-labelledby"],"aria-label":o["aria-label"]},n)}(),le=o.filter?e.createElement(x,{filter:I,onFilter:K,disabled:o.disabled,filterPlaceholder:o.filterPlaceholder,filterInputProps:o.filterInputProps}):null;return e.createElement(e.Fragment,null,e.createElement("div",s({ref:S,id:o.id,className:te,style:o.style},ee),le,e.createElement("div",{className:ne,style:o.listStyle},re)),Z&&e.createElement(r,s({target:S,content:o.tooltip},o.tooltipOptions)))})));P.displayName="ListBox",P.defaultProps={__TYPE:"ListBox",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,itemTemplate:null,style:null,listStyle:null,listClassName:null,className:null,virtualScrollerOptions:null,disabled:null,dataKey:null,multiple:!1,metaKeySelection:!1,filter:!1,filterBy:null,filterValue:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,filterInputProps:null,tabIndex:0,tooltip:null,tooltipOptions:null,"aria-label":null,"aria-labelledby":null,onChange:null,onFilterValueChange:null};export{P as ListBox};
